<!--pages/my/my.wxml-->
<view class="page-container">
  <!-- ä½¿ç”¨ç»Ÿä¸€çš„å¯¼èˆªæ ç»„ä»¶ -->
  <navigation-bar
    title="æˆ‘çš„"
    background="var(--card-background)"
    color="var(--primary-color)"
  ></navigation-bar>

  <scroll-view 
    class="scrollarea" 
    scroll-y="true"
    enable-flex="true"
    refresher-enabled="{{true}}"
    refresher-threshold="50"
    refresher-default-style="black"
    refresher-background="#f2f2f7"
    enhanced="true" 
    show-scrollbar="false" 
    bounces="true"
    fast-deceleration="{{true}}"
    scroll-anchoring="true"
    scroll-with-animation="true">
    <view class="container">
      <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
      <view class="user-card">
        <view class="user-avatar-container">
          <image class="user-avatar" src="{{avatarUrl}}" mode="aspectFill"></image>
        </view>
        
        <view class="user-info-container">
          <block wx:if="{{isLoggedIn && userInfo}}">
            <view class="user-name">{{userInfo.nickname || 'å¥åº·é¥®é£Ÿç”¨æˆ·'}}</view>
            <view class="user-id">ID: {{userInfo.openid || 'æœªç™»å½•'}}</view>
          </block>
          <block wx:else>
            <view class="user-name">æœªç™»å½•</view>
            <view class="user-id">ç‚¹å‡»ç™»å½•è·å–æ›´å¤šåŠŸèƒ½</view>
          </block>
        </view>
        
        <view class="user-action">
          <block wx:if="{{isLoggedIn}}">
            <button class="btn-edit" bindtap="editUserInfo" style="position: relative; left: 0rpx; top: 0rpx; width: 150rpx; display: flex; box-sizing: border-box">ç¼–è¾‘</button>
          </block>
          <block wx:else>
            <button class="btn-login" bindtap="handleLogin" loading="{{isLoading}}">ç™»å½•</button>
          </block>
        </view>
      </view>
      
      <!-- å¥åº·æ•°æ®å¡ç‰‡ -->
      <view class="health-card">
        <view class="card-header">
          <text class="card-title">å¥åº·æ•°æ®</text>
          <text class="card-subtitle">æœ€è¿‘æ›´æ–°</text>
        </view>
        
        <view class="health-data-grid">
          <view class="health-data-item">
            <text class="data-label">å¹´é¾„</text>
            <text class="data-value">{{healthData.age}}</text>
          </view>
          <view class="health-data-item">
            <text class="data-label">æ€§åˆ«</text>
            <text class="data-value">{{healthData.gender}}</text>
          </view>
          <view class="health-data-item">
            <text class="data-label">èº«é«˜</text>
            <text class="data-value">{{healthData.height}}</text>
          </view>
          <view class="health-data-item">
            <text class="data-label">ä½“é‡</text>
            <text class="data-value">{{healthData.weight}}</text>
          </view>
          <view class="health-data-item">
            <text class="data-label">BMI</text>
            <text class="data-value">{{healthData.bmi}}</text>
          </view>
          <view class="health-data-item">
            <text class="data-label">çŠ¶æ€</text>
            <text class="data-value">{{healthData.bmiStatus}}</text>
          </view>
        </view>
      </view>
      
      <!-- å¥åº·çŠ¶å†µå¡ç‰‡ -->
      <block wx:if="{{isLoggedIn && userInfo}}">
        <view class="health-status-card" wx:if="{{userInfo.diseases && userInfo.diseases.length > 0}}">
          <view class="card-header">
            <text class="card-title">å¥åº·çŠ¶å†µ</text>
          </view>
          
          <view class="tag-container">
            <block wx:for="{{userInfo.diseases}}" wx:key="*this">
              <view class="tag tag-disease">{{diseaseLabels[item] || item}}</view>
            </block>
          </view>
        </view>
        
        <!-- å¥åº·ç”Ÿæ´»æ–¹å¼å¡ç‰‡ -->
        <view class="health-status-card" wx:if="{{userInfo.healthStatus && userInfo.healthStatus.length > 0}}">
          <view class="card-header">
            <text class="card-title">ç”Ÿæ´»æ–¹å¼</text>
          </view>
          
          <view class="tag-container">
            <block wx:for="{{userInfo.healthStatus}}" wx:key="*this">
              <view class="tag tag-lifestyle">{{healthStatusLabels[item] || item}}</view>
            </block>
          </view>
        </view>
        
        <!-- é¥®é£Ÿåå¥½å¡ç‰‡ -->
        <view class="health-status-card" wx:if="{{userInfo.dietPreferences && userInfo.dietPreferences.length > 0}}">
          <view class="card-header">
            <text class="card-title">é¥®é£Ÿåå¥½</text>
          </view>
          
          <view class="tag-container">
            <block wx:for="{{userInfo.dietPreferences}}" wx:key="*this">
              <view class="tag tag-diet">{{dietPreferenceLabels[item] || item}}</view>
            </block>
          </view>
        </view>
      </block>
      
      <!-- åŠŸèƒ½åˆ—è¡¨ -->
      
      <view class="function-list">
        <view class="function-item" bindtap="editUserInfo">
          <view class="icon-container icon-personal">
            <text class="icon-edit"></text>
          </view>
          <view class="function-name">ä¸ªäººä¿¡æ¯</view>
          <view class="function-arrow"></view>
        </view>
        
        <view class="function-item" bindtap="goToCart">
          <view class="icon-container icon-cart">
            <text class="icon-cart">ğŸ›’</text>
          </view>
          <view class="function-name">è´­ç‰©è½¦</view>
          <view class="function-arrow"></view>
        </view>
        
        <view class="function-item">
          <view class="icon-container icon-history">
            <text class="icon-history"></text>
          </view>
          <view class="function-name">é¥®é£Ÿè®°å½•</view>
          <view class="function-arrow"></view>
        </view>
        
        <view class="function-item">
          <view class="icon-container icon-favorites">
            <text class="icon-favorite"></text>
          </view>
          <view class="function-name">æˆ‘çš„æ”¶è—</view>
          <view class="function-arrow"></view>
        </view>
        
        <view class="function-item">
          <view class="icon-container icon-settings">
            <text class="icon-settings"></text>
          </view>
          <view class="function-name">è®¾ç½®</view>
          <view class="function-arrow"></view>
        </view>
      </view>
      
      <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
      <block wx:if="{{isLoggedIn}}">
        <view class="logout-container">
          <button class="btn-logout" bindtap="handleLogout" style="position: relative; left: 0rpx; top: -39rpx">é€€å‡ºç™»å½•</button>
        </view>
      </block>
      
      <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
      <view class="version-info">
        <text>å¥åº·é¥®é£Ÿ v1.0.0</text>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area-bottom"></view>
  
  <!-- ä½¿ç”¨è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆªæ ç»„ä»¶ -->
  <tab-bar activeTab="{{activeTab}}"></tab-bar>
</view> 