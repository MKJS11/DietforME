<!--pages/recipe/list.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="status-bar"></view>
  
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="back-button" bindtap="goBack">
      <text class="back-icon">â†</text>
    </view>
    <view class="page-title">å¥åº·é£Ÿè°±</view>
    <view class="nav-actions">
      <view class="search-icon" bindtap="showSearch">ğŸ”</view>
    </view>
  </view>
  
  <!-- æœç´¢æ  -->
  <view class="search-bar" wx:if="{{showSearchBar}}">
    <input class="search-input" placeholder="æœç´¢é£Ÿè°±æˆ–é£Ÿæ" confirm-type="search" bindinput="onSearchInput" bindconfirm="searchRecipes" value="{{searchKeyword}}"/>
    <view class="search-cancel" bindtap="hideSearch">å–æ¶ˆ</view>
  </view>
  
  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="filter-bar">
    <scroll-view class="filter-scroll" scroll-x="true" enhanced="true" show-scrollbar="false" fast-deceleration="{{true}}">
      <view class="filter-tags">
        <view class="filter-tag {{currentCategory === 'all' ? 'active' : ''}}" bindtap="selectCategory" data-category="all">å…¨éƒ¨</view>
        <view class="filter-tag {{currentCategory === 'breakfast' ? 'active' : ''}}" bindtap="selectCategory" data-category="breakfast">æ—©é¤</view>
        <view class="filter-tag {{currentCategory === 'lunch' ? 'active' : ''}}" bindtap="selectCategory" data-category="lunch">åˆé¤</view>
        <view class="filter-tag {{currentCategory === 'dinner' ? 'active' : ''}}" bindtap="selectCategory" data-category="dinner">æ™šé¤</view>
        <view class="filter-tag {{currentCategory === 'snack' ? 'active' : ''}}" bindtap="selectCategory" data-category="snack">å°é£Ÿ</view>
        <view class="filter-tag {{currentCategory === 'vegetarian' ? 'active' : ''}}" bindtap="selectCategory" data-category="vegetarian">ç´ é£Ÿ</view>
        <view class="filter-tag {{currentCategory === 'lowcarb' ? 'active' : ''}}" bindtap="selectCategory" data-category="lowcarb">ä½ç¢³æ°´</view>
        <view class="filter-tag {{currentCategory === 'highprotein' ? 'active' : ''}}" bindtap="selectCategory" data-category="highprotein">é«˜è›‹ç™½</view>
        <view class="filter-tag {{currentCategory === 'recommended' ? 'active' : ''}}" bindtap="selectCategory" data-category="recommended">æ¨è</view>
      </view>
    </scroll-view>
  </view>
  
  <!-- æ“ä½œæ  -->
  <view class="action-bar">
    <view class="last-updated" wx:if="{{lastUpdated}}">
      æœ€åæ›´æ–°: {{lastUpdated}}
    </view>
    <view class="action-buttons">
      <button class="btn-refresh-api" bindtap="refreshFromAPI" loading="{{isLoadingAPI}}">
        ä»APIè·å–æ–°é£Ÿè°±
      </button>
    </view>
  </view>
  
  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view class="scrollarea" scroll-y type="list" enhanced="true" show-scrollbar="false" bounces="true" bindscrolltolower="loadMore">
    <!-- åŠ è½½ä¸­çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{isLoading && !isLoadingMore}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½é£Ÿè°±ä¸­...</text>
    </view>
    
    <!-- é”™è¯¯çŠ¶æ€ -->
    <view class="error-container" wx:elif="{{loadingError}}">
      <text class="error-icon">âš ï¸</text>
      <text class="error-text">{{loadingError}}</text>
      <view class="error-actions">
        <button class="error-action-btn" bindtap="refreshRecipes">ä»æ•°æ®åº“åˆ·æ–°</button>
        <button class="error-action-btn primary" bindtap="refreshFromAPI">ä»APIè·å–</button>
      </view>
    </view>
    
    <!-- é£Ÿè°±åˆ—è¡¨ -->
    <view class="recipe-list" wx:elif="{{filteredRecipes.length > 0}}">
      <view class="data-source-tip">
        <text>æ•°æ®æ¥æº: <text class="api-source">ç«å±±å¤§æ¨¡å‹API</text></text>
        <text wx:if="{{lastUpdated}}" class="update-time">æœ€åæ›´æ–°: {{lastUpdated}}</text>
        <text class="recipe-count">å½“å‰å…±æœ‰ {{recipes.length}} ä¸ªé£Ÿè°±</text>
      </view>
      
      <view wx:for="{{filteredRecipes}}" wx:key="id" class="recipe-card" bindtap="viewRecipeDetail" data-id="{{item._id}}">
        <view class="recipe-header">
          <text class="recipe-name">{{item.name}}</text>
          <view class="favorite-icon {{item.isFavorite ? 'active' : ''}}" catchtap="toggleFavorite" data-id="{{item._id}}">
            {{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}
          </view>
        </view>
        <view class="recipe-info">
          <view class="recipe-meta">
            <text class="recipe-time">{{item.time}}</text>
            <text class="recipe-calories">{{item.calories}}</text>
            <text class="recipe-tag" wx:if="{{item.tag}}">{{item.tag}}</text>
          </view>
          <view class="recipe-ingredients" wx:if="{{item.ingredients}}">
            <text class="ingredients-label">ä¸»è¦é£Ÿæ:</text>
            <text class="ingredients-text">{{item.ingredients.join(', ')}}</text>
          </view>
          <text class="recipe-benefits" wx:if="{{item.benefits}}">{{item.benefits}}</text>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view class="loading-more" wx:if="{{isLoadingMore}}">
        <view class="loading-spinner-small"></view>
        <text class="loading-text-small">åŠ è½½æ›´å¤š...</text>
      </view>
    </view>
    
    <!-- æ²¡æœ‰é£Ÿè°±æ—¶æ˜¾ç¤º -->
    <view class="no-recipes" wx:else>
      <text class="no-recipes-icon">ğŸ½ï¸</text>
      <text class="no-recipes-text">æš‚æ— ç¬¦åˆæ¡ä»¶çš„é£Ÿè°±</text>
      <view class="no-recipes-actions">
        <button class="no-recipes-action-btn" bindtap="resetFilters">é‡ç½®ç­›é€‰</button>
        <button class="no-recipes-action-btn primary" bindtap="refreshFromAPI">ä»APIè·å–</button>
      </view>
    </view>
  </scroll-view>
  
  <!-- æ‚¬æµ®æŒ‰é’® -->
  <view class="floating-button" bindtap="refreshRecipes">
    <text class="floating-icon">ğŸ”„</text>
    <text class="floating-text">åˆ·æ–°</text>
  </view>
</view> 